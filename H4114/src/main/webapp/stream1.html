<!DOCTYPE html>
<html>
    <head>
        <title>Start Page</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="./js/camera.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    </head>
    <body>
        <h1 id="displayName">Hello a toi!</h1>
        <input type="text" id="name" placeholder="Name"/>
        <button id="recordName">Log</button>
        <table id="freeRoom">
            <thead>
                <tr><td>Room number</td><td>Numberof persons</td><td>Join this room</td></tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
        
        <div id="errorMsg"></div>
        
        <script>
            var name = '';
            function recordName(){
                var champNom = $('#nom').val();
                name = champNom;
                $("#displayName").html("Welcome "+champNom);
            }
            
            function joinRoom(number){
               connectListen(number);
            }
            
            function startRoom(){
                var roomNumber;
                 $.ajax({
                    url: './ActionServlet2',
                    method: 'POST',
                    data: {
                        action : 'create'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    var response = data;
                    roomNumber = response.index;
                });
                connectStart(roomNumber);
            }
            
            function getRoomInfos(rooms){
                clearInfos();
                var RoomHTML = $('#tableBody');
                if(rooms.length === 0){
                    var strNull = '<td colspan="3">There is no room yet.</td>';
                     RoomHTML.append(strNull);
                }else{
                    var i = 0;
                    var str = '';
                    for(i = 0; rooms.length; i++){
                        var element = rooms[i];
                        var numRoom = element.num;
                        var numPersons = element.person;
                        str = '<tr>';
                        str = str + '<td>'+ numRoom + '</td>';
                        str = str + '<td>' + numPersons + '</td>';
                        str = str + '<td><button type="button" class="btn btn-outline-primary"' + ' value="' + numRoom +'" >Join</button></td>';
                        str = str + '</tr>';
                    }
                    RoomHTML.append(str);
                }
            }
            
            function clearInfos(){
                $("#tableBody").html("");
            }
            
            function rereshInfos(){
                 $.ajax({
                    url: './ActionServlet2',
                    method: 'POST',
                    data: {
                        action : 'room'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    // ici votre code...
                    // 
                    // si connexion ok, aller sur la page suivante :
                    //$('#message').html('<b> bonjour </b>');
                    var response = data;
                    var chambers = response.rooms;
                    getRoomInfos(chambers);
                });
            }

            
            $(document).ready(function () {
                $.ajax({
                    url: './ActionServlet2',
                    method: 'POST',
                    data: {
                        action : 'room'
                    },
                    dataType: 'json'
                }).done(function (data) {
                    // ici votre code...
                    // 
                    // si connexion ok, aller sur la page suivante :
                    //$('#message').html('<b> bonjour </b>');
                    var response = data;
                    console.log(response);
                    var chambers = response.rooms;
                    getRoomInfos(chambers);
                    $('#recordName').on('click', function () {
                        recordName();
                    });
                });
            });
        
        </script>
    </body>
</html>
